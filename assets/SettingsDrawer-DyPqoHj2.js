import{r as e,t,j as s,K as o,c as a,m as n,S as l,B as r,I as i,N as c,T as d,d as p,O as m,P as h}from"./vendor-react-antd-CV6UOIML.js";import{A as g,P as j,s as x,d as u}from"./index-C6v3DSkX.js";import{d as y}from"./vendor-dayjs-BMl2ZANK.js";import{D as v}from"./vendor-others-B_SqjRtK.js";const{useToken:f}=t,k=e.memo((({open:t,setOpen:k,model:S,setModel:b,promptItems:C,setPromptItems:I,promptKey:A,setPromptKey:P,sendMessage:w})=>{const{token:T}=f(),[O,_]=e.useState(g.getProvider()),[M,K]=e.useState(g.getCustomProviderConfig().apiUrl),[L,D]=e.useState(g.getCustomProviderConfig().modelListUrl);e.useEffect((()=>{const e=localStorage.getItem("promptKey");e&&P(e)}),[P]);return s.jsx(o,{title:"设置",onClose:()=>{k(!1)},open:t,children:s.jsxs(a,{vertical:!0,gap:8,children:[s.jsxs(a,{gap:5,align:"center",justify:"space-between",children:[s.jsx(n.Text,{children:"AI提供商:"}),s.jsx(l,{style:{width:"80%"},value:O,options:g.getProviders(),onChange:e=>{_(e),g.setProvider(e);let t="";switch(e){case"siliconflow":t="已切换到硅基流动供应商";break;case"openai":t="已切换到OpenAI供应商";break;case"deepseek":t="已切换到DeepSeek供应商";break;case"gemini":t="已切换到Gemini供应商";break;case"custom":t="已切换到自定义供应商";break;default:t="已切换供应商"}t+="，正在尝试加载可用模型列表，请稍等...",w(t),setTimeout((()=>{g.isCustomModelAllowed()&&w("未能获取模型列表或供应商不支持模型列表API，请手动输入模型名称")}),2e3)}})]}),"siliconflow"===O&&s.jsxs(a,{vertical:!0,gap:5,children:[s.jsx(n.Text,{type:"secondary",children:"硅基流动是推荐的中文AI服务提供商"}),s.jsx(r,{type:"link",href:"https://cloud.siliconflow.cn/i/8jXtDiez",target:"_blank",children:"点击这里注册获取2000万免费Tokens"})]}),"deepseek"===O&&s.jsxs(a,{vertical:!0,gap:5,children:[s.jsx(n.Text,{type:"secondary",children:"DeepSeek提供高性能的推理和对话模型"}),s.jsx(r,{type:"link",href:"https://platform.deepseek.com/api_keys",target:"_blank",children:"点击这里申请DeepSeek API密钥"})]}),"openai"===O&&s.jsxs(a,{vertical:!0,gap:5,children:[s.jsx(n.Text,{type:"secondary",children:"OpenAI提供GPT系列大语言模型"}),s.jsx(r,{type:"link",href:"https://platform.openai.com/api-keys",target:"_blank",children:"点击这里申请OpenAI API密钥"})]}),"gemini"===O&&s.jsxs(a,{vertical:!0,gap:5,children:[s.jsx(n.Text,{type:"secondary",children:"Gemini是Google开发的先进大语言模型"}),s.jsx(r,{type:"link",href:"https://ai.google.dev/",target:"_blank",children:"点击这里申请Gemini API密钥"})]}),"custom"===O&&s.jsxs(a,{vertical:!0,gap:10,children:[s.jsx(n.Text,{children:"自定义供应商设置:"}),s.jsx(n.Text,{type:"secondary",children:"可配置兼容OpenAI格式的API服务，例如本地部署的LLM、私有云等"}),s.jsx(i,{addonBefore:"API基础URL",placeholder:"https://your-api-endpoint.com",value:M.split("/v1/chat/completions")[0],onChange:e=>{const t=e.target.value.trim();K(`${t}/v1/chat/completions`),D(`${t}/v1/models`)}}),s.jsx(i,{addonBefore:"聊天完成URL",placeholder:"https://your-api-endpoint.com/v1/chat/completions",value:M,onChange:e=>K(e.target.value)}),s.jsx(i,{addonBefore:"模型列表URL",placeholder:"https://your-api-endpoint.com/v1/models",value:L,onChange:e=>D(e.target.value)}),s.jsx(r,{type:"primary",onClick:()=>{g.setCustomProviderConfig({apiUrl:M,modelListUrl:L}),w("自定义供应商配置已保存，请刷新页面加载可用模型")},children:"保存配置"})]}),s.jsx(c,{}),s.jsxs(a,{gap:5,align:"center",justify:"space-between",children:[s.jsx(n.Text,{children:"模型:"}),g.model_list.length>0&&!g.isCustomModelAllowed()?s.jsx(l,{style:{width:"85%"},value:S,options:g.model_list.map((e=>({value:e,label:e}))),onSelect:e=>{b(e)}}):s.jsx(i,{style:{width:"85%"},placeholder:"请输入模型名称",value:S,onChange:e=>{const t=e.target.value;b(t)}})]}),g.isCustomModelAllowed()&&s.jsx(n.Text,{type:"secondary",style:{fontSize:"12px"},children:"未检测到可用的模型列表，请手动输入模型名称"}),s.jsx(i,{addonBefore:"请输入API Key",placeholder:g.tokenReady()?g.getMackToken():"请输入",onChange:e=>{const t=e.target.value.trim();g.setToken(t),localStorage.setItem("api_key",t),w("API Key设置成功, 请刷新页面加载可用模型.")}}),s.jsxs(a,{vertical:!0,gap:5,justify:"space-between",children:[s.jsxs(a,{align:"center",justify:"space-between",children:[s.jsx(n.Text,{children:"提示词:"}),s.jsx(d,{title:"选择模板",children:s.jsx(l,{style:{width:"30%"},defaultValue:localStorage.getItem("promptKey")||"programming",options:[...Object.entries(C).map((e=>({value:e[0],label:e[1].name}))),{value:"custom",label:"自定义"}],onSelect:e=>{if("custom"===e){const e=v();I({...C,[e]:{name:"请输入提示词名称",prompt:C[A].prompt}}),P(e)}else P(e),localStorage.setItem("promptKey",e)}})})]}),s.jsx(i,{addonBefore:"名称",addonAfter:s.jsxs(a,{gap:20,children:[s.jsx(p,{style:{fontSize:T.controlHeightXS,color:A in j?void 0:T.colorError},onClick:()=>{const e={...C};delete e[A],P(Object.keys(C)[0]),I(e),x(e)}}),s.jsx(m,{style:{fontSize:T.controlHeightXS,color:A in j?void 0:T.colorPrimary},onClick:()=>{x(C)}})]}),value:C[A].name,disabled:A in j,onChange:e=>{const t=e.target.value,s={...C,[A]:{...C[A],name:t}};I(s)}}),s.jsx(i.TextArea,{disabled:A in j,value:C[A].prompt,autoSize:{minRows:10,maxRows:15},title:"提示语",onChange:e=>{const t=e.target.value,s={...C,[A]:{...C[A],prompt:t}};I(s)}})]}),s.jsx(c,{}),s.jsxs(a,{align:"center",justify:"space-between",children:[s.jsx(r,{type:"link",icon:s.jsx(h,{}),onClick:()=>{(()=>{const e={};Object.keys(localStorage).forEach((t=>{try{const s=localStorage.getItem(t);if(t.startsWith("__tea_cache_")||"version"===t||!s)return;e[t]=JSON.parse(s||"")}catch(s){}})),u(e,`备份_${y().format("YYYY-MM-DD-HH-mm")}.json`)})()},children:"备份全部信息"}),s.jsx(r,{type:"link",icon:s.jsx(h,{}),onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.click(),e.addEventListener("change",(()=>{const t=e.files?e.files[0]:null;t&&(e=>{const t=new FileReader;t.onload=e=>{var t;try{const s=null==(t=e.target)?void 0:t.result,o=JSON.parse(s);Object.keys(o).forEach((e=>{localStorage.setItem(e,JSON.stringify(o[e]))}))}catch(s){}},t.readAsText(e)})(t)})),document.body.removeChild(e)},children:"导入全部信息"})]})]})})}));export{k as default};
