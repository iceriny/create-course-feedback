const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C7RoepyE.js","assets/vendor-react-antd-CRdMjcEk.js","assets/vendor-others-B_SqjRtK.js","assets/vendor-dayjs-BMl2ZANK.js","assets/SettingsDrawer-Bi4ThJ8k.js","assets/StudentsList-DgtIbXal.js","assets/TemplateEditor-BhdvODDE.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{r as s,j as n,M as o,L as r,R as i,B as a,D as l,F as c,t as u,a as d,C as m,b as h,I as p,S as g,c as f,d as v,e as j,f as y,g as x,h as b,T as S,i as k,k as _,l as C,A as M,m as T,n as w,o as I,p as E,q as O,s as L,u as P,v as N,w as V,x as A,y as R,z as $,E as q}from"./vendor-react-antd-CRdMjcEk.js";import{C as U,D}from"./vendor-others-B_SqjRtK.js";import{d as F}from"./vendor-dayjs-BMl2ZANK.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Q=class e{constructor(){t(this,"currentVersion"),t(this,"versionInfos",[]),t(this,"pendingVersions",[]),t(this,"updateModalVisible",!1),t(this,"isLoading",!1),this.currentVersion="0.5.4"}static getInstance(){return e.instance||(e.instance=new e),e.instance}async checkForUpdates(){if(this.isLoading||this.updateModalVisible)return this.updateModalVisible;try{this.isLoading=!0;const e=localStorage.getItem("version")||"0.0.0",t=await fetch("version-list.json"),s=[...await t.json()].sort(((e,t)=>U(e,t))),n=s.length>0?s[s.length-1]:this.currentVersion;return this.pendingVersions=s.filter((t=>U(t,e)>0)),this.pendingVersions.length>0&&(await this.loadVersionInfos(),localStorage.setItem("version",n),this.updateModalVisible=!0,!0)}catch(e){return!1}finally{this.isLoading=!1}}async loadVersionInfos(){this.versionInfos=[];for(const t of this.pendingVersions)try{const e=await fetch(`versions/${t}.json`),s=await e.json();this.versionInfos.push(s)}catch(e){}this.versionInfos.sort(((e,t)=>U(e.version,t.version)))}closeUpdateModal(){this.updateModalVisible=!1,this.versionInfos=[],this.pendingVersions=[]}getCurrentVersion(){return this.currentVersion}getUpdateInfo(){return this.versionInfos}isUpdateModalVisible(){return this.updateModalVisible}};t(Q,"instance");let Y=Q;const J=()=>{const e=Y.getInstance(),[t,l]=s.useState([]),[c,u]=s.useState(!1);s.useEffect((()=>{(async()=>{await e.checkForUpdates()&&e.isUpdateModalVisible()&&(u(!0),l(e.getUpdateInfo().reverse()))})()}),[]);const d=()=>{e.closeUpdateModal(),u(!1)};return n.jsx(o,{open:c,title:n.jsxs("span",{children:["已更新 当前版本: ",e.getCurrentVersion()]}),onOk:d,footer:[n.jsx(a,{type:"primary",onClick:d,children:"确认"},"submit")],children:c&&n.jsx(r,{itemLayout:"vertical",dataSource:t,renderItem:e=>n.jsxs(r.Item,{children:[n.jsx(r.Item.Meta,{title:e.version,description:`更新日期: ${e.date}`}),n.jsx("div",{className:"version-content",children:e.content.split("\n").map(((e,t)=>n.jsx("p",{children:e.startsWith("-")?n.jsxs(n.Fragment,{children:[n.jsx(i,{style:{marginRight:5}}),e.substring(2)]}):e},t)))})]})})})},B={},H=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));n=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in B)return;B[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script"),o.crossOrigin="",o.href=e,s&&o.setAttribute("nonce",s),document.head.appendChild(o),t?new Promise(((t,s)=>{o.addEventListener("load",t),o.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then((t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)}))},z={siliconflow:{name:"硅基流动",apiUrl:"https://api.siliconflow.cn/v1/chat/completions",modelListUrl:"https://api.siliconflow.cn/v1/models?type=text",defaultModel:"Qwen/Qwen3-32B"},openai:{name:"OpenAI",apiUrl:"https://api.openai.com/v1/chat/completions",modelListUrl:"https://api.openai.com/v1/models",defaultModel:"gpt-3.5-turbo"},deepseek:{name:"DeepSeek",apiUrl:"https://api.deepseek.com/chat/completions",modelListUrl:"https://api.deepseek.com/models",defaultModel:"deepseek-chat"},gemini:{name:"Gemini",apiUrl:"https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent",modelListUrl:"https://generativelanguage.googleapis.com/v1/models",defaultModel:"gemini-pro"},custom:{name:"自定义",apiUrl:"",modelListUrl:"",defaultModel:"Qwen/Qwen3-32B"}},W=class e{constructor(){t(this,"messages",null),t(this,"option",null),t(this,"requestQueue",[]),t(this,"activeRequests",0),t(this,"processing",!1),t(this,"requestsThisSecond",0),t(this,"requestsThisMinute",0),t(this,"lastSecond",0),t(this,"lastMinute",0),this.init()}init(){const t=localStorage.getItem("api_provider");t&&(e.provider=t);const s=localStorage.getItem("custom_provider_config");s&&(e.customProviderConfig=JSON.parse(s)),this.messages={model:e.model,messages:[],stream:!0,max_tokens:8192,stop:null,temperature:.7,top_p:1,top_k:50,frequency_penalty:.5,n:1},e.is_qwen3()&&(this.messages.enable_thinking=!0,this.messages.thinking_budget=5e3,this.messages.min_p=.05),this.option={method:"POST",headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"},body:null};const n=localStorage.getItem("api_key");n&&e.setToken(n),e.getModelList();const o=localStorage.getItem("custom_model");o&&"custom"===e.provider&&(e.model=o,this.messages.model=o)}static is_qwen3(){return e.model.includes("Qwen3")}static setToken(t){e.token=t}static tokenReady(){return void 0!==e.token&&""!==e.token&&null!==e.token}static getMackToken(){return`已存在令牌:${e.token.slice(0,4)} ***……*** ${e.token.slice(-6)}`}setMessageBody(){this.option&&this.messages&&(this.option.headers.Authorization=`Bearer ${e.token}`,this.option.body=JSON.stringify(this.messages))}static getCurrentProviderConfig(){return"custom"===e.provider?e.customProviderConfig:z[e.provider]}static setProvider(t){e.provider=t,localStorage.setItem("api_provider",t),e.model=e.getCurrentProviderConfig().defaultModel,e.getModelList()}static getProvider(){return e.provider}static setCustomProviderConfig(t){e.customProviderConfig={...e.customProviderConfig,...t},localStorage.setItem("custom_provider_config",JSON.stringify(e.customProviderConfig)),"custom"===e.provider&&e.getModelList()}static getCustomProviderConfig(){return e.customProviderConfig}static getProviders(){return Object.entries(z).map((([e,t])=>({value:e,label:t.name})))}static setCustomModel(t){t&&""!==t.trim()&&(e.model=t.trim(),localStorage.setItem("custom_model",e.model))}static isCustomModelAllowed(){return e.allowCustomModel||!e.modelListAvailable||0===e.model_list.length}static addThrottleListener(t){return e.throttleListeners.push(t),()=>{e.throttleListeners=e.throttleListeners.filter((e=>e!==t))}}static notifyThrottleListeners(t,s){e.throttleListeners.forEach((e=>e(t,s)))}getThrottleStatus(){const t=Math.floor(Date.now()/1e3),s=Math.floor(t/60);t!==this.lastSecond&&(this.lastSecond=t,this.requestsThisSecond=0),s!==this.lastMinute&&(this.lastMinute=s,this.requestsThisMinute=0);const n=this.requestsThisSecond>=e.MAX_REQUESTS_PER_SECOND,o=this.requestsThisMinute>=e.MAX_REQUESTS_PER_MINUTE;return{isThrottled:n||o,shouldNotify:o,message:o?"每分钟请求数超过限制，请等待(由于API提供商的限制，每分钟最多只能发送10次请求)":"",requestsThisSecond:this.requestsThisSecond,requestsThisMinute:this.requestsThisMinute,availableConcurrent:Math.min(e.MAX_REQUESTS_PER_SECOND-this.requestsThisSecond,e.MAX_REQUESTS_PER_MINUTE-this.requestsThisMinute)}}async processQueue(){if(!this.processing&&0!==this.requestQueue.length){this.processing=!0;try{const t=this.getThrottleStatus();if(t.isThrottled){t.shouldNotify&&e.notifyThrottleListeners(!0,t.message);const s=t.requestsThisSecond>=e.MAX_REQUESTS_PER_SECOND?1e3:5e3;return void setTimeout((()=>{this.processing=!1,this.processQueue()}),s)}e.notifyThrottleListeners(!1,"");const s=t.availableConcurrent;if(s<=0)return void setTimeout((()=>{this.processing=!1,this.processQueue()}),1e3);const n=Math.min(s,this.requestQueue.length);this.requestsThisSecond+=n,this.requestsThisMinute+=n;const o=[];for(let e=0;e<n;e++){const e=this.requestQueue.shift();if(e){this.activeRequests++;const t=this._sendMessage(e.message,e.callback,e.onFinish).finally((()=>{this.activeRequests--,this.requestQueue.length>0&&!this.processing&&this.processQueue()}));o.push(t)}}this.processing=!1,this.requestQueue.length>0&&setTimeout((()=>this.processQueue()),50)}catch(t){this.processing=!1,setTimeout((()=>this.processQueue()),1e3)}}}async sendMessage(e,t,...s){this.requestQueue.push({message:s,callback:e,onFinish:t}),this.processQueue()}async _sendMessage(t,s,n){var o;if(!this.messages||!this.option)return;this.messages.messages=this.messages.messages.concat(t),this.setMessageBody();const r=e.getCurrentProviderConfig();if("gemini"===e.getProvider())return this._sendGeminiMessage(t,s,n);const i=null==(o=(await fetch(r.apiUrl,this.option)).body)?void 0:o.getReader();if(!i)return;const a=new TextDecoder("utf-8");let l="",c="",u=0;for(;;){const{done:e,value:t}=await i.read();if(e||u>5){null==n||n();break}const o=a.decode(t,{stream:!0}).split("\n");for(const n of o)if(n.startsWith("data: ")){const e=n.slice(6);if("[DONE]"===e)break;try{const t=JSON.parse(e),n=t.choices[0].delta.reasoning_content;n&&(c+=n,null==s||s(c,"reasoning_content"));const o=t.choices[0].delta.content;o&&(l+=o,null==s||s(l,"content")),null===n&&null===o&&u++}catch(d){null==s||s(null)}}}}async _sendGeminiMessage(t,s,n){if(!this.messages)return;const o={contents:t.map((e=>({role:"assistant"===e.role?"model":e.role,parts:[{text:e.content}]}))),generationConfig:{temperature:this.messages.temperature,topP:this.messages.top_p,topK:this.messages.top_k,maxOutputTokens:this.messages.max_tokens}},r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)},i=`${e.getCurrentProviderConfig().apiUrl}?key=${e.token}`;try{const e=await fetch(i,r),t=await e.json();if(t.error)return null==s||s(null),void(null==n||n());let o="";t.candidates&&t.candidates.length>0&&(o=t.candidates[0].content.parts[0].text,null==s||s(o,"content")),null==n||n()}catch(a){null==s||s(null),null==n||n()}}static async getModelList(){e.modelListAvailable=!0;const t={method:"GET",headers:{Authorization:`Bearer ${e.token}`}},s=e.getCurrentProviderConfig();if(!s.modelListUrl)return void(e.modelListAvailable=!1);const n=e.getProvider();if("gemini"!==n)fetch(s.modelListUrl,t).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((t=>{const s=t.data;if(!(s&&s.length>0))throw e.modelListAvailable=!1,new Error("No models found in response");e.model_list=s.map((e=>e.id))})).catch((t=>{switch(e.modelListAvailable=!1,n){case"openai":e.model_list=["gpt-3.5-turbo","gpt-4","gpt-4-turbo"];break;case"deepseek":e.model_list=["deepseek-chat","deepseek-reasoner"];break;case"siliconflow":e.model_list=["Qwen/Qwen3-32B"];break;case"custom":e.allowCustomModel=!0,e.model_list=[];break;default:e.model_list=[]}}));else{const t=`${s.modelListUrl}?key=${e.token}`;fetch(t).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((t=>{t.models&&t.models.length>0?e.model_list=t.models.map((e=>e.name)):(e.model_list=["gemini-pro","gemini-pro-vision"],e.modelListAvailable=!1)})).catch((t=>{e.model_list=["gemini-pro","gemini-pro-vision"],e.modelListAvailable=!1}))}}static setModel(t){e.model=t}static getModel(){return e.model}};t(W,"token"),t(W,"model_list",[]),t(W,"model","Qwen/Qwen3-32B"),t(W,"modelListAvailable",!0),t(W,"allowCustomModel",!1),t(W,"provider","siliconflow"),t(W,"customProviderConfig",{name:"自定义",apiUrl:"",modelListUrl:"",defaultModel:"Qwen/Qwen3-32B"}),t(W,"MAX_REQUESTS_PER_SECOND",3),t(W,"MAX_REQUESTS_PER_MINUTE",10),t(W,"throttleListeners",[]);let X=W;window.API=new X;const G={programming:{name:"编程",prompt:'## 角色定位：编程教师\n- 你是一位专注于小学和初高中学生编程教育的老师\n- 以下[方括号]内容为重点要求\n\n## 任务说明：\n- 我会提供课程基本信息（课程名称、时间、内容概览、教学目标）\n- 我会提供[单个]学生的课堂表现关键词\n- 用 `<!...>` 包裹的内容是特殊标注,不是直接在反馈中使用的,是给你提供的额外的信息.比如:<!插班生>, <!女孩>\n- 请针对这位学生的表现进行[优化扩写]，控制在[80字左右]，输出不需要标记显示字数.\n\n## 内容要求：\n- [仅需撰写课堂表现部分]，不要修改其他内容\n- 表现描述需[平衡指出优点和不足]，语气友善且有建设性\n- [重要提醒]：这是发给家长的反馈，请注意家长感受和情绪，但是如果关键词中用词比较严厉，请适当优化，但不能完全美化\n- [禁止添加虚构内容]，不要编造未提及的具体事件（如"某某最先完成..."）\n- 使用[宏观描述]而非具体课堂细节\n- 请不要出现[比如..]这样的描述,即禁止出现编造细节.\n- 语言风格[自然口语化]，避免过于正式或官方的表述，要更亲切，接地气\n- 不需要有额外标记，比如: `(优点)`这样的标记内容\n- 对于学生的称呼,使用名字即可(不带姓氏)不需要叫小名.\n- 不要太频繁的使用语气词.\n\n## 输出格式：\n请直接输出课堂表现文本，无需包含任何格式标记或额外内容\n不需要在文本中标记字数'},robot:{name:"机器人",prompt:'## 角色定位：机器人(机械搭建)教师\n- 你是一位专注于小学和初高中学生机器人(机械搭建)的老师\n- 以下[方括号]内容为重点要求\n\n## 任务说明：\n- 我会提供课程基本信息（课程名称、时间、内容概览、教学目标）\n- 我会提供[单个]学生的课堂表现关键词\n- 请针对这位学生的表现进行[优化扩写]，控制在[80字左右]\n\n## 内容要求：\n- [仅需撰写课堂表现部分]，不要修改其他内容\n- 表现描述需[平衡指出优点和不足]，语气友善且有建设性\n- [重要提醒]：这是发给家长的反馈，请注意家长感受和情绪\n- [禁止添加虚构内容]，不要编造未提及的具体事件（如"某某最先完成..."）\n- 使用[宏观描述]而非具体课堂细节\n- 请不要出现[比如..]这样的描述,即禁止出现编造细节.\n- 语言风格[自然口语化]，避免过于正式或官方的表述，要更亲切，接地气\n\n## 输出格式：\n请直接输出课堂表现文本，无需包含任何格式标记或额外内容'}};function K(){const e=localStorage.getItem("prompts");return e?JSON.parse(e):{}}function Z(e){for(const[t,s]of Object.entries(e));localStorage.setItem("prompts",JSON.stringify(e))}function ee(e,t){let s=e;t.courseName&&(s=s.replace(/{{courseName}}/g,`《${t.courseName}》`)),t.courseTime&&(s=s.replace(/{{courseTime}}/g,`@${t.courseTime[0].format("YYYY[年] MM[月]DD[日] HH:mm")} -> ${t.courseTime[1].format("HH:mm")}`)),t.courseContents&&(s=s.replace(/{{courseContents}}/g,t.courseContents.join(""))),t.courseObjectives&&(s=s.replace(/{{courseObjectives}}/g,t.courseObjectives.join(""))),t.signature&&(s=s.replace(/{{signature}}/g,t.signature));const n=t.customDate||F();return s=s.replace(/{{currentDate}}/g,n.format("YYYY[年] MM[月]DD[日]")),t.courseFeedback&&(s=s.replace(/{{courseFeedback}}/g,t.courseFeedback)),s}const te=s.lazy((()=>H((()=>import("./index-C7RoepyE.js")),__vite__mapDeps([0,1,2,3])))),se=s.lazy((()=>H((()=>import("./SettingsDrawer-Bi4ThJ8k.js")),__vite__mapDeps([4,1,2,3])))),ne=s.lazy((()=>H((()=>import("./StudentsList-DgtIbXal.js")),__vite__mapDeps([5,1,2,3])))),oe=s.lazy((()=>H((()=>import("./TemplateEditor-BhdvODDE.js")),__vite__mapDeps([6,1,2,3])))),re="**课程名称:** {{courseName}}\n\n**授课时间:** {{courseTime}}\n\n**课程内容概览:**\n{{courseContents}}\n\n**教学目标:**\n{{courseObjectives}}\n\n**课堂表现:**\n{{courseFeedback}}\n\n{{signature}}\n{{currentDate}}",ie="**课程名称:** {{courseName}}\n\n**授课时间:** {{courseTime}}\n\n**课程内容概览:**\n{{courseContents}}\n\n**教学目标:**\n{{courseObjectives}}",{RangePicker:ae}=l,{useToken:le}=u,ce=({sendMessage:e,sendWarning:t})=>{const[o]=c.useForm(),[r]=c.useForm(),[i,l]=s.useState([]),[u,N]=s.useState({}),[V,A]=s.useState("programming"),[R,$]=s.useState({...G,...K()}),[q,U]=s.useState((Q="class-name",JSON.parse(localStorage.getItem(Q)??"[]")));var Q;const Y=s.useRef(!1),[J,B]=s.useState(!1),[z,W]=s.useState(X.getModel),[Z,ce]=s.useState({}),{token:ue}=le(),[de,me]=s.useState(!1),[he,pe]=s.useState(""),[ge,fe]=s.useState(!1),[ve,je]=s.useState(re),[ye,xe]=s.useState(re),be=s.useRef(ie),[Se,ke]=s.useState("哆啦人工智能小栈"),_e=s.useCallback((e=>{W(e),localStorage.setItem("ai-model",JSON.stringify(e))}),[W]);s.useEffect((()=>{const e=localStorage.getItem("class-history");e&&ce(JSON.parse(e));const t=localStorage.getItem("feedback-template");t&&(je(t),xe(t));const s=localStorage.getItem("signature");s&&ke(s);const n=setTimeout((()=>{(()=>{const e=[H((()=>import("./index-C7RoepyE.js")),__vite__mapDeps([0,1,2,3])),H((()=>import("./SettingsDrawer-Bi4ThJ8k.js")),__vite__mapDeps([4,1,2,3])),H((()=>import("./StudentsList-DgtIbXal.js")),__vite__mapDeps([5,1,2,3]))];Promise.all(e).catch((e=>{}))})()}),1e3),o=X.addThrottleListener(((e,t)=>{me(e),pe(t)})),r=localStorage.getItem("ai-model");return r&&W(JSON.parse(r)),()=>{clearTimeout(n),o()}}),[]);const Ce=s.useCallback((t=>{navigator.clipboard.writeText(t),e("已导出到剪切板.")}),[e]),Me=s.useCallback((()=>{const t=o.getFieldsValue();t.get=e=>t[e];const s=t.get("class-name"),n=t.get("course-name"),r=t.get("course-contents").map((e=>`- ${e.item}\n`)),i=t.get("course-objectives").map((e=>`- ${e.item}\n`)),a=t.get("course-time"),l=ee(ve,{courseName:n,courseTime:a,courseContents:r,courseObjectives:i,signature:Se});xe(l);const c=ee(ie,{courseName:n,courseTime:a,courseContents:r,courseObjectives:i});be.current=c;const u={time:{first:a[0].format("YYYY-MM-DD HH:mm"),last:a[1].format("YYYY-MM-DD HH:mm")}};localStorage.setItem(s,JSON.stringify(u));const d=function(e,...t){const s=JSON.parse(localStorage.getItem(e)??"[]");for(const n of t)s.includes(n)||s.push(n);return localStorage.setItem(e,JSON.stringify(s)),s}("class-name",s);U(d);const m={...Z},h=new Set;for(const e in m){const{courseName:t}=m[e];h.add(t)}if(h.has(n))for(const e in m){const{courseName:s}=m[e];s===n&&(m[e]={courseName:n,courseContents:t.get("course-contents"),courseObjectives:t.get("course-objectives")})}else{m[D()]={courseName:n,courseContents:t.get("course-contents"),courseObjectives:t.get("course-objectives")}}if(Object.keys(m).length>10){delete m[Object.keys(m)[0]]}ce(m),localStorage.setItem("class-history",JSON.stringify(m)),Y.current=!0,e("课程信息提交成功！")}),[o,Z,e,ve,Se]),Te=s.useCallback((t=>{const s=localStorage.getItem(t);if(s){const e=JSON.parse(s),t=F(e.time.first),n=F(e.time.last),r=F().subtract(1,"week").day(t.day()).hour(t.hour()).minute(t.minute()),i=F().subtract(1,"week").day(n.day()).hour(n.hour()).minute(n.minute());o.setFieldsValue({"course-time":[r,i]})}else e("未找到该班级的数据, 请检查班级名是否正确.");const n=localStorage.getItem(`${t}_std`);if(n){const e=JSON.parse(n);l(e);const t={};for(const[s,n]of e.entries())t[s]={name:n,content:"",think_content:"",loading:!1,activated:!0};N(t)}}),[o,e]),we=s.useCallback((()=>{const e=o.getFieldValue("class-name");e&&""!==e?Te(e):t("请先输入班级名.")}),[o,Te,t]),Ie=s.useCallback((e=>{N((t=>{const s={...t};return s[e]={...s[e],loading:!0},s})),(new X).sendMessage(((t,s)=>{null!==s&&null!==t&&N((n=>{const o={...n};switch(s){case"content":o[e]={...o[e],content:t};break;case"reasoning_content":o[e]={...o[e],think_content:t}}return o}))}),(()=>{N((t=>{const s={...t};let n=s[e].content.replace(/(?:(?:\*\*)?课堂表现.*?(?::|：)(?:\*\*)?)(?::|：)?/,"");return n=n.replace(/\d{4}年 ?\d{1,2}月\d{1,2}(?:日|天)/,""),n=n.replace(/哆啦人工智能小栈/,""),n=n.trim(),s[e]={...s[e],content:n,loading:!1},s}))}),{content:R[V].prompt,role:"system"},{content:be.current,role:"user"},{content:`学员姓名: ${i[e]}`,role:"user"},{content:r.getFieldValue(["content",e])??"",role:"user"})}),[r,R,V,i]),Ee=s.useCallback((()=>{if(!1!==Y.current)if(!1!==X.tokenReady())for(const[e]of i.entries())u[e].activated&&Ie(e);else t("请先输入API Key.");else t("请先完成课程信息的填写. 或再次点击提交按钮.")}),[Ie,t,i,u]),Oe=s.useCallback((e=>{const t=Z[e];t&&o.setFieldsValue({"course-name":t.courseName,"course-contents":t.courseContents,"course-objectives":t.courseObjectives})}),[o,Z]),Le=s.useCallback((e=>{var t,s,n;const r=o.getFieldsValue(),a=e=>r[e],l=a("course-name"),c=(null==(t=a("course-contents"))?void 0:t.map((e=>`- ${e.item}\n`)))||[],d=(null==(s=a("course-objectives"))?void 0:s.map((e=>`- ${e.item}\n`)))||[],m=a("course-time");let h=`### ${i[e]}\n`;h+=ee(ye,{courseName:l,courseTime:m,courseContents:c,courseObjectives:d,signature:Se,courseFeedback:(null==(n=u[e])?void 0:n.content)||""}),Ce(h)}),[o,Ce,ye,Se,i,u]),Pe=s.useCallback(((e,t)=>{localStorage.setItem("feedback-template",e),localStorage.setItem("signature",t),je(e),xe(e),ke(t),fe(!1)}),[]);return n.jsxs(n.Fragment,{children:[n.jsx(s.Suspense,{fallback:n.jsx("div",{children:"加载中..."}),children:n.jsx(se,{open:J,setOpen:B,model:z,setModel:_e,promptItems:R,setPromptItems:$,promptKey:V,setPromptKey:A,sendMessage:e})}),n.jsx(s.Suspense,{fallback:n.jsx("div",{children:"加载中..."}),children:n.jsx(oe,{isOpen:ge,onClose:()=>fe(!1),onSave:Pe,initialTemplate:ve,initialSignature:Se,sendMessage:e})}),n.jsxs(d,{gutter:[72,64],children:[n.jsx(m,{span:2}),n.jsx(m,{span:16,children:n.jsx(c,{layout:"vertical",labelCol:{span:6},wrapperCol:{span:18},form:o,name:"course-info",autoComplete:"off",onFinish:Me,onFieldsChange:()=>Y.current=!1,initialValues:{items:[{}]},children:n.jsxs(h,{id:"course-info-card",size:"default",title:n.jsxs(n.Fragment,{children:[n.jsx(x,{style:{marginRight:"2rem",color:ue.colorPrimary}}),"课程信息"]}),style:{minWidth:"800px",boxShadow:"10px 10px 80px 10px rgba(0, 0, 0, 0.1)"},actions:[n.jsx(a,{style:{width:"100%"},type:"link",htmlType:"submit",children:"提交"},"submit"),n.jsxs(a,{type:"link",onClick:Ee,children:[n.jsx(j,{}),"AI 优化"]},"ai"),n.jsx(a,{style:{width:"100%"},type:"link",onClick:we,children:"导入"},"import"),n.jsxs(a,{style:{width:"100%"},type:"link",onClick:()=>{fe(!0)},children:[n.jsx(y,{}),"自定义模板"]},"template")],children:[n.jsx(c.Item,{label:"班级名",name:"class-name",rules:[{required:!0}],children:n.jsx(p,{addonAfter:n.jsx(g,{defaultValue:null,notFoundContent:"无录入班级信息",placeholder:"选择班级",style:{width:120},onSelect:e=>{null!==e&&(Te(e),o.setFieldValue("class-name",e))},options:q.map((e=>({value:e,label:e})))})})}),n.jsx(c.Item,{label:"课程名称",name:"course-name",rules:[{required:!0}],children:n.jsx(p,{addonAfter:n.jsx(g,{defaultValue:null,notFoundContent:"无历史记录",placeholder:"历史记录",style:{width:120},onSelect:e=>{null!==e&&Oe(e)},options:Object.keys(Z).map((e=>({value:e,label:Z[e].courseName})))})})}),n.jsx(c.Item,{label:"授课时间",name:"course-time",rules:[{required:!0}],children:n.jsx(ae,{showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm"})}),n.jsx(c.Item,{label:"课程内容",children:n.jsx(c.List,{name:"course-contents",rules:[{validator:async(e,t)=>{if(!t||t.length<1)return Promise.reject(new Error("至少需要有一个课程内容"))}}],children:(e,t,{errors:s})=>n.jsxs("div",{style:{display:"flex",flexDirection:"column",rowGap:16},children:[e.map((e=>n.jsxs(f,{children:[n.jsx(c.Item,{noStyle:!0,name:[e.name,"item"],rules:[{required:!0}],children:n.jsx(p,{style:{width:350},onPressEnter:()=>{t.add()},placeholder:"填写课程内容"})}),n.jsx(v,{onClick:()=>{t.remove(e.name)}})]},e.key))),n.jsx(a,{type:"dashed",onClick:()=>t.add(),block:!0,children:"+ 添加课程内容"}),n.jsx(c.ErrorList,{errors:s})]})})}),n.jsx(c.Item,{label:"教学目标",children:n.jsx(c.List,{name:"course-objectives",rules:[{validator:async(e,t)=>{if(!t||t.length<1)return Promise.reject(new Error("至少需要有一个课程目标"))}}],children:(e,t,{errors:s})=>n.jsxs("div",{style:{display:"flex",flexDirection:"column",rowGap:16},children:[e.map((e=>n.jsxs(f,{children:[n.jsx(c.Item,{noStyle:!0,name:[e.name,"item"],rules:[{required:!0}],children:n.jsx(p,{style:{width:350},placeholder:"填写课程内容"})}),n.jsx(v,{onClick:()=>{t.remove(e.name)}})]},e.key))),n.jsx(a,{type:"dashed",onClick:()=>t.add(),block:!0,children:"+ 添加课程内容"}),n.jsx(c.ErrorList,{errors:s})]})})})]})})}),n.jsx(m,{span:6,children:n.jsx(s.Suspense,{fallback:n.jsx("div",{children:"加载中..."}),children:n.jsxs(b,{vertical:!0,gap:10,children:[n.jsx(te,{values_:i,activated_list_:Object.values(u).map((e=>e.activated)),onChange:e=>{const t=o.getFieldValue("class-name");if(!t)return;const s={...u};for(const[n,o]of e.entries())s[n]={name:o,content:"",think_content:"",loading:!1,activated:!0};N(s),l(e),localStorage.setItem(`${t}_std`,JSON.stringify(e))},onClear:()=>{N({}),l([])},onActive:(e,t)=>{N((s=>{const n={...s};return n[e]={...n[e],activated:t[e]},n}))}}),i.length>0&&n.jsxs(b,{gap:10,children:[n.jsx(S,{placement:"top",title:"复制学生列表",children:n.jsx(a,{icon:n.jsx(k,{}),size:"small",onClick:()=>{Ce(i.join(", "))}})}),n.jsx(S,{placement:"top",title:"按首字母顺序排序",children:n.jsx(a,{icon:n.jsx(_,{}),size:"small",onClick:()=>{const e=[...i].sort(((e,t)=>e.localeCompare(t)));l(e);const t=Object.fromEntries(Object.entries(u).map((([e,t])=>({key:Number(e),value:t}))).sort(((e,t)=>e.value.name.localeCompare(t.value.name))).map(((e,t)=>[t,e.value])));N(t);const s=o.getFieldValue("class-name");s&&localStorage.setItem(`${s}_std`,JSON.stringify(e))}})}),n.jsx(S,{placement:"top",title:"人数统计",children:n.jsx(C.Text,{style:{textAlign:"center"},children:`${Object.values(u).filter((e=>e.activated)).length}/${i.length}人`})})]})]})})}),n.jsx(m,{span:2}),n.jsx(m,{span:16,children:n.jsx(c,{form:r,name:"student-content",children:n.jsx(s.Suspense,{fallback:n.jsx("div",{children:"加载中..."}),children:n.jsx(ne,{students:i,students_info:u,handleSingleAIOptimize:Ie,copyToClipboard:Ce,copyStudentWithTemplate:Le})})})}),n.jsx(m,{span:6,children:i.length>0&&n.jsx(M,{offsetTop:100,items:[{key:"course-info-card-anchor",title:"回到顶部",href:"#course-info-card"}].concat(i.map(((e,t)=>({key:`student-content-anchor-${t}`,title:e,href:`#student-content-${t}`}))))})})]}),de&&n.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e3,padding:"10px 15px",background:ue.colorWarning,borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:"10px"},children:[n.jsx(T,{indicator:n.jsx(w,{style:{fontSize:18,color:"#fff"},spin:!0})}),n.jsx(I,{color:"warning",children:he})]}),n.jsx(E,{icon:n.jsx(O,{}),type:"default",tooltip:"导出内容到剪切板.",style:{insetInlineEnd:72},onClick:()=>{var e,s,n;Y.current||t("内容可能不完整, 或未点击提交按钮.");const r=o.getFieldsValue(),a=e=>r[e],l=a("course-name"),c=(null==(e=a("course-contents"))?void 0:e.map((e=>`- ${e.item}\n`)))||[],d=(null==(s=a("course-objectives"))?void 0:s.map((e=>`- ${e.item}\n`)))||[],m=a("course-time");let h="";for(const[t,o]of i.entries()){h+=`### ${o}\n`;h+=ee(ye,{courseName:l,courseTime:m,courseContents:c,courseObjectives:d,signature:Se,courseFeedback:(null==(n=u[t])?void 0:n.content)||""}),h+="\n\n---\n"}Ce(h)}}),n.jsx(E,{icon:n.jsx(O,{}),type:"primary",tooltip:"导出内容到剪切板(不包括空反馈的学生以及没有打勾的学生).",style:{insetInlineEnd:24},onClick:()=>{var e,s,n,r,a;Y.current||t("内容可能不完整, 或未点击提交按钮.");const l=o.getFieldsValue(),c=e=>l[e],d=c("course-name"),m=(null==(e=c("course-contents"))?void 0:e.map((e=>`- ${e.item}\n`)))||[],h=(null==(s=c("course-objectives"))?void 0:s.map((e=>`- ${e.item}\n`)))||[],p=c("course-time");let g="";for(const[t,o]of i.entries()){if(""===(null==(n=u[t])?void 0:n.content)||!(null==(r=u[t])?void 0:r.activated))continue;g+=`### ${o}\n`;g+=ee(ye,{courseName:d,courseTime:p,courseContents:m,courseObjectives:h,signature:Se,courseFeedback:(null==(a=u[t])?void 0:a.content)||""}),g+="\n\n---\n"}Ce(g)}}),n.jsx(L,{theme:{token:X.tokenReady()?void 0:{colorBgElevated:ue.colorError}},children:n.jsx(E,{icon:n.jsx(P,{style:{color:X.tokenReady()?void 0:"white"}}),tooltip:"展开设置面板.",style:{insetBlockEnd:128},onClick:()=>{B(!0)}})})]})},ue=e=>{const t={marginLeft:"1em",marginRight:"1em",...e.style};return n.jsx(N,{...e,style:t,component:V})},{Header:de,Footer:me,Content:he}=A,{useToken:pe}=u,ge=({sendMessage:e,sendWarning:t})=>{const{token:s}=pe();return n.jsxs(A,{style:{minHeight:"100vh"},children:[n.jsx(de,{style:{fontSize:"1.5rem"},children:n.jsxs(b,{justify:"space-between",children:[n.jsxs("span",{children:[n.jsx(ue,{}),"课程反馈生成器"]}),n.jsxs("span",{children:["v","0.5.4"]})]})}),n.jsx(he,{style:{padding:"50px 50px"},children:n.jsx(ce,{sendMessage:e,sendWarning:t})}),n.jsx(me,{style:{backgroundColor:s.colorBgBase},children:n.jsxs(b,{justify:"space-between",children:[n.jsx("span",{children:"Made by Iceriny"}),n.jsx("span",{style:{paddingRight:"100px"},children:"© Iceriny. 保留所有权利."})]})})]})};F.locale("en");const fe=()=>{const[e,t]=R.useMessage(),o=s.useCallback(((t,s,n)=>{e.info(t,s,n)}),[e]),r=s.useCallback(((t,s,n)=>{e.warning(t,s,n)}),[e]);return n.jsxs(L,{locale:$,theme:{components:{Layout:{headerColor:"rgb(255, 255, 255)"}}},children:[t,n.jsx(ge,{sendMessage:o,sendWarning:r}),n.jsx(J,{})]})};q.createRoot(document.getElementById("root")).render(n.jsx(s.StrictMode,{children:n.jsx(fe,{})}));export{X as A,G as P,Z as s};
